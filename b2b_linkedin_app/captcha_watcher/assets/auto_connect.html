    <!DOCTYPE html>
    <html lang="en">
    <head>
        <meta charset="utf-8">
        <title>LinkedIn Captcha VNC ‚Äì Auto Connect</title>
        <meta name="viewport" content="width=device-width, initial-scale=1">

        <!-- –°—Ç–∏–ª–∏ —Å–∞–º–æ–≥–æ noVNC (–æ–±—ã—á–Ω–æ –≤ /opt/novnc/app/styles/) -->
        <link rel="stylesheet" href="styles/base.css" />
        <link rel="stylesheet" href="styles/ui.css" />

        <style>
            /* –ù–µ–º–Ω–æ–≥–æ ¬´–≥–ª–∞–º—É—Ä–∞¬ª –¥–ª—è –∑–∞—Å—Ç–∞–≤–∫–∏ */
            body {
                margin: 0;
                padding: 0;
                font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
                background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
                min-height: 100vh;
                color: #fff;
            }
            .header {
                background: rgba(0, 0, 0, 0.85);
                padding: 12px 20px;
                text-align: center;
                position: sticky;
                top: 0;
                z-index: 100;
            }
            .header h2 {
                margin: 0;
                font-size: 1.25rem;
            }
            .header p {
                margin: 4px 0 0;
                font-size: 0.9rem;
                opacity: 0.85;
            }
            #screen {
                width: 100%;
                height: calc(100vh - 200px);
                background: #000;
                border: 2px solid #333;
                border-radius: 8px;
                margin: 10px auto;
                box-sizing: border-box;
            }
            .loading-overlay {
                position: fixed;
                top: 0; left: 0;
                width: 100%; height: 100%;
                background: rgba(0,0,0,0.9);
                display: flex;
                align-items: center;
                justify-content: center;
                z-index: 1000;
                transition: opacity 0.5s ease;
            }
            .loading-content {
                text-align: center;
            }
            .spinner {
                width: 50px;
                height: 50px;
                border: 5px solid #444;
                border-top: 5px solid #00aced;
                border-radius: 50%;
                animation: spin 1s linear infinite;
                margin: 0 auto 16px;
            }
            @keyframes spin {
                0%   { transform: rotate(0deg); }
                100% { transform: rotate(360deg); }
            }
            .hidden {
                opacity: 0;
                pointer-events: none;
            }
            .status {
                text-align: center;
                margin: 10px 0;
                padding: 8px 12px;
                border-radius: 4px;
                font-weight: bold;
                max-width: 600px;
                margin-left: auto;
                margin-right: auto;
            }
            .status.connecting { background: #cce5ff; color: #004085; }
            .status.connected  { background: #d4edda; color: #155724; }
            .status.error      { background: #f8d7da; color: #721c24; }
            .instructions {
                background: rgba(255, 243, 205, 0.95);
                border: 1px solid #ffeeba;
                border-radius: 8px;
                color: #856404;
                max-width: 600px;
                margin: 8px auto;
                padding: 12px 16px;
            }
            .instructions h3 {
                margin-top: 0;
                font-size: 1rem;
            }
            .instructions ol {
                margin: 0 0 0 16px;
                padding: 0;
                font-size: 0.9rem;
                line-height: 1.4;
            }
            .retry-button {
                display: inline-block;
                background: #007bff;
                color: #fff;
                border: none;
                padding: 8px 16px;
                border-radius: 4px;
                cursor: pointer;
                font-size: 0.9rem;
                margin: 12px 4px;
            }
            .retry-button:hover {
                background: #0056b3;
            }
            .retry-button:disabled {
                background: #6c757d;
                cursor: not-allowed;
            }
        </style>
    </head>
    <body>
        <div class="header">
            <h2>üîê LinkedIn Captcha Resolution</h2>
            <p>VNC Remote Desktop ‚Äì Auto-connecting‚Ä¶</p>
        </div>

        <!-- –û–≤–µ—Ä–ª–µ–π-–∑–∞—Å—Ç–∞–≤–∫–∞ –≤–æ –≤—Ä–µ–º—è —É—Å—Ç–∞–Ω–æ–≤–∫–∏ —Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è -->
        <div class="loading-overlay" id="loadingOverlay">
            <div class="loading-content">
                <div class="spinner"></div>
                <h3>Connecting to VNC Server</h3>
                <p>Setting up remote desktop for captcha resolution‚Ä¶</p>
                <p><small>This may take 10‚Äì15 seconds</small></p>
            </div>
        </div>

        <!-- –°—Ç—Ä–æ–∫–∞ —Å—Ç–∞—Ç—É—Å–∞ –ø—Ä—è–º–æ –ø–æ–¥ —à–∞–ø–∫–æ–π -->
        <div class="status connecting" id="status">
            üîÑ Initializing VNC connection...
        </div>

        <!-- –ò–Ω—Å—Ç—Ä—É–∫—Ü–∏—è –¥–ª—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è, –∫–∞–∫ —Ä–µ—à–∏—Ç—å –∫–∞–ø—á—É –≤—Ä—É—á–Ω—É—é -->
        <div class="instructions">
            <h3>üìã How to solve the captcha:</h3>
            <ol>
                <li>Wait until the virtual desktop –ø–æ–ª–Ω–æ—Å—Ç—å—é –∑–∞–≥—Ä—É–∑–∏—Ç—Å—è.</li>
                <li>–í—ã —É–≤–∏–¥–∏—Ç–µ Chrome —Å —Ñ–æ—Ä–º–æ–π –≤—Ö–æ–¥–∞ LinkedIn.</li>
                <li>–ü—Ä–æ–π–¥–∏—Ç–µ –ª—é–±—É—é captcha –∏–ª–∏ security challenge.</li>
                <li>–ê–≤—Ç–æ—Ä–∏–∑—É–π—Ç–µ—Å—å, –Ω–∞–∂–∞–≤ ¬´Sign in¬ª (–ª–æ–≥–∏–Ω/–ø–∞—Ä–æ–ª—å —É–∂–µ –≤–ø–∏—Å–∞–Ω—ã).</li>
                <li>–î–æ–∂–¥–∏—Ç–µ—Å—å, –ø–æ–∫–∞ –∑–∞–≥—Ä—É–∑–∏—Ç—Å—è –≤–∞—à–∞ –ª–µ–Ω—Ç–∞/–ø—Ä–æ—Ñ–∏–ª—å LinkedIn.</li>
                <li>–°–∏—Å—Ç–µ–º–∞ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –∑–∞—Ñ–∏–∫—Å–∏—Ä—É–µ—Ç —É—Å–ø–µ—à–Ω—ã–π –≤—Ö–æ–¥.</li>
            </ol>
        </div>

        <!-- –ö–Ω–æ–ø–∫–∏ ¬´–ü–µ—Ä–µ–ø–æ–¥–∫–ª—é—á–∏—Ç—å—Å—è¬ª –∏ ¬´–û–±–Ω–æ–≤–∏—Ç—å —Å—Ç—Ä–∞–Ω–∏—Ü—É¬ª -->
        <div style="text-align: center;">
            <button id="retryButton" class="retry-button" onclick="retryConnection()" style="display: none;">
                üîÑ Retry Connection
            </button>
            <button class="retry-button" onclick="window.location.reload()">
                üîÉ Refresh Page
            </button>
        </div>

        <!-- –ö–æ–Ω—Ç–µ–π–Ω–µ—Ä, –≤ –∫–æ—Ç–æ—Ä–æ–º —Ä–∏—Å—É–µ—Ç—Å—è VNC-–ø–æ–ª–æ—Ç–Ω–æ -->
        <div id="screen"></div>

        <!-- –ü–æ–¥–∫–ª—é—á–∞–µ–º core/rfb.js –∏–∑ –ø–∞–ø–∫–∏ noVNC -->
        <script type="module" crossorigin="anonymous">
            import RFB from './core/rfb.js';

            let rfb = null;
            let connectionAttempts = 0;
            const maxRetries = 5;
            let isConnecting = false;
            let hasConnectedOnce = false;

            function updateStatus(text, className = 'connecting') {
                const statusEl = document.getElementById('status');
                statusEl.textContent = text;
                statusEl.className = `status ${className}`;
            }

            function hideLoading() {
                const overlay = document.getElementById('loadingOverlay');
                setTimeout(() => overlay.classList.add('hidden'), 1000);
            }

            function showRetryButton() {
                const btn = document.getElementById('retryButton');
                btn.style.display = 'inline-block';
                btn.disabled = false;
            }

            function hideRetryButton() {
                document.getElementById('retryButton').style.display = 'none';
            }

            function connectedToServer(e) {
                updateStatus('‚úÖ Connected to VNC server', 'connected');
                hideLoading();
                hideRetryButton();
                hasConnectedOnce = true;
                isConnecting = false;
                console.log('‚úÖ VNC connection established successfully');
            }

            function disconnectedFromServer(e) {
                isConnecting = false;
                if (hasConnectedOnce) {
                    // –ï—Å–ª–∏ —Ö–æ—Ç—è –±—ã —Ä–∞–∑ –∫–æ–Ω–Ω–µ–∫—Ç–∏–ª–∏—Å—å, –ø—Ä–æ—Å—Ç–æ –ø–æ–∫–∞–∑—ã–≤–∞–µ–º —Å–æ–æ–±—â–µ–Ω–∏–µ –æ–± –æ—Ç–∫–ª—é—á–µ–Ω–∏–∏
                    updateStatus('üîå Disconnected from VNC server', 'error');
                } else {
                    // –ï—Å–ª–∏ –µ—â—ë –Ω–∏ —Ä–∞–∑—É –Ω–µ –ø–æ–¥–∫–ª—é—á–∏–ª–∏—Å—å, –ø—Ä–æ–±—É–µ–º —Ä–µ—Ç—Ä–∞—è—Ç—å –¥–æ maxRetries
                    updateStatus('‚ùå Connection failed ‚Äî retrying‚Ä¶', 'error');
                    if (connectionAttempts < maxRetries) {
                        setTimeout(connect, 2000);
                    } else {
                        showRetryButton();
                    }
                }
            }

            function credentialsRequired(e) {
                // –í –Ω–∞—à–µ–º —Å–ª—É—á–∞–µ –º—ã —Å—Ç–∞—Ä—Ç—É–µ–º x11vnc —Å -nopw, –Ω–æ –Ω–∞ –≤—Å—è–∫–∏–π —Å–ª—É—á–∞–π:
                updateStatus('üîë No password required', 'connecting');
                rfb.sendCredentials({ password: '' });
            }

            function connect() {
                if (isConnecting) return;
                connectionAttempts++;
                isConnecting = true;

                updateStatus(`üîÑ Connecting to VNC server (attempt ${connectionAttempts}/${maxRetries})`, 'connecting');
                hideRetryButton();

                const host = window.location.hostname || 'localhost';
                const port = '6080';
                const protocol = (window.location.protocol === 'https:') ? 'wss:' : 'ws:';

                // **–í–∞–∂–Ω—ã–π –º–æ–º–µ–Ω—Ç**: –º—ã –∏—Å–ø–æ–ª—å–∑—É–µ–º WebSocket –Ω–∞ ‚Äú–∫–æ—Ä–Ω–µ‚Äù (/), 
                // –ø–æ—Ç–æ–º—É —á—Ç–æ websockify –≤ –Ω–∞—à–µ–º supervisord.conf –∑–∞–ø—É—Å–∫–∞–µ—Ç—Å—è –∫–∞–∫:
                //    websockify.py --web /opt/novnc --heartbeat=30 0.0.0.0:6080 127.0.0.1:5900
                // –∏, –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é, —Å–ª—É—à–∞–µ—Ç WS-–∑–∞–ø—Ä–æ—Å—ã –Ω–∞ ‚Äú/websockify‚Äù –∏–ª–∏ –ø—Ä–æ—Å—Ç–æ ‚Äú/‚Äù,
                // –≤ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –æ—Ç –≤–µ—Ä—Å–∏–∏. –ù–∞ —Å–æ–≤—Ä–µ–º–µ–Ω–Ω—ã—Ö —Å–±–æ—Ä–∫–∞—Ö noVNC –¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ —Å–ª–∞—Ç—å –∑–∞–ø—Ä–æ—Å—ã –Ω–∞ ‚Äú/‚Äù.
                // –ü–æ—ç—Ç–æ–º—É –≤ URL –º—ã –Ω–µ —É–∫–∞–∑—ã–≤–∞–µ–º ‚Äú/websockify‚Äù, –∞ –ø—Ä–æ—Å—Ç–æ:
                const url = `${protocol}//${host}:${port}/`;

                console.log(`Attempting VNC connection to: ${url}`);

                try {
                    if (rfb) {
                        try { rfb.disconnect(); }
                        catch(e) { console.warn('Error while disconnecting previous RFB:', e); }
                    }

                    rfb = new RFB(document.getElementById('screen'), url, {
                        credentials: { password: '' }
                    });
                    rfb.addEventListener('connect', connectedToServer);
                    rfb.addEventListener('disconnect', disconnectedFromServer);
                    rfb.addEventListener('credentialsrequired', credentialsRequired);

                    // –ü–∞—Ä–∞–º–µ—Ç—Ä—ã –∫–∞—á–µ—Å—Ç–≤–∞/–º–∞—Å—à—Ç–∞–±–∏—Ä–æ–≤–∞–Ω–∏—è
                    rfb.scaleViewport   = true;
                    rfb.resizeSession   = true;
                    rfb.qualityLevel    = 6;
                    rfb.compressionLevel= 2;
                } catch (exc) {
                    isConnecting = false;
                    updateStatus(`‚ùå Connection error: ${exc}`, 'error');
                    console.error('Connection exception:', exc);
                    if (connectionAttempts < maxRetries) {
                        setTimeout(connect, 3000);
                    } else {
                        updateStatus(`‚ùå Max retries reached. Please refresh.`, 'error');
                        showRetryButton();
                    }
                }
            }

            function retryConnection() {
                if (connectionAttempts >= maxRetries) connectionAttempts = 0;
                console.log(`Manual retry requested (${connectionAttempts + 1}/${maxRetries})`);
                const btn = document.getElementById('retryButton');
                btn.disabled = true;
                btn.textContent = '‚è≥ Retrying‚Ä¶';
                setTimeout(() => {
                    connect();
                    btn.textContent = 'üîÑ Retry Connection';
                }, 1000);
            }

            // –ê–≤—Ç–æ–ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ —Å—Ç—Ä–∞–Ω–∏—Ü—ã
            window.addEventListener('load', () => {
                updateStatus('üöÄ Starting VNC connection‚Ä¶', 'connecting');
                // –Ω–µ–±–æ–ª—å—à–∞—è –∑–∞–¥–µ—Ä–∂–∫–∞, —á—Ç–æ–±—ã DOM —É—Å–ø–µ–ª –Ω–∞—Ä–∏—Å–æ–≤–∞—Ç—å—Å—è
                setTimeout(connect, 500);
            });

            // –ì–ª–æ–±–∞–ª—å–Ω—ã–π –ø–µ—Ä–µ—Ö–≤–∞—Ç –æ—à–∏–±–æ–∫ WebSocket, —á—Ç–æ–±—ã —Ç—Ä–∏–≥–≥–µ—Ä–∏—Ç—å —Ä–µ—Ç—Ä–∞–µ–≤
            window.addEventListener('error', (e) => {
                console.error('Global error:', e.error);
                if (e.error && e.error.message && e.error.message.includes('WebSocket') && !hasConnectedOnce) {
                    isConnecting = false;
                    if (connectionAttempts < maxRetries) {
                        setTimeout(connect, 2000);
                    }
                }
            });

            // –î–µ–ª–∞–µ–º —Ñ—É–Ω–∫—Ü–∏—é retryConnection() –¥–æ—Å—Ç—É–ø–Ω–æ–π –≥–ª–æ–±–∞–ª—å–Ω–æ
            window.retryConnection = retryConnection;
        </script>
    </body>
    </html>
